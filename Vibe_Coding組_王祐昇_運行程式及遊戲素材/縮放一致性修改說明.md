# Fate Keys - ç¸®æ”¾ä¸€è‡´æ€§ä¿®æ”¹èªªæ˜

## ğŸ¯ ä¿®æ”¹ç›®æ¨™

ç¢ºä¿ä¸­å¤®éœ“è™¹å¼•å°ç·šã€éŸ³ç¬¦æ‰è½è»Œé“èˆ‡èƒŒæ™¯è³½é“ç¸®æ”¾ä¿æŒä¸€è‡´ï¼Œæä¾›çµ±ä¸€çš„è¦–è¦ºé«”é©—ã€‚

## ğŸ”§ ä¸»è¦ä¿®æ”¹å…§å®¹

### 1. JavaScript ä¿®æ”¹ (game.js)

#### 1.1 è»Œé“ç®¡ç†å™¨ (laneManager.drawLanes)
- **ä½ç½®**: `game.js` ç¬¬1295è¡Œé–‹å§‹
- **ä¿®æ”¹å…§å®¹**:
  - æ·»åŠ äº†èˆ‡CSSä¸€è‡´çš„3Dé€è¦–è®Šæ›
  - æ‡‰ç”¨ `perspective(800px) rotateX(8deg)` è®Šæ›
  - å¯¦ç¾ `clip-path: polygon(25% 0, 75% 0, 100% 100%, 0 100%)` æ•ˆæœ
  - ç¢ºä¿è»Œé“å¯¬åº¦è¨ˆç®—ï¼š`canvas.width / laneCount`

```javascript
// æ‡‰ç”¨èˆ‡CSSä¸€è‡´çš„3Dé€è¦–è®Šæ›
ctx.save();

// è¨­ç½®é€è¦–è®Šæ›ï¼Œèˆ‡CSSä¸­çš„ perspective(800px) rotateX(8deg) ä¿æŒä¸€è‡´
const perspective = 800;
const rotateX = 8 * Math.PI / 180; // 8åº¦è½‰å¼§åº¦

// è¨ˆç®—é€è¦–è®Šæ›çŸ©é™£
const centerX = canvas.width / 2;
const centerY = canvas.height / 2;

// æ‡‰ç”¨é€è¦–è®Šæ›
ctx.translate(centerX, centerY);
ctx.transform(
    1, 0,
    0, Math.cos(rotateX),
    0, 0
);
ctx.translate(-centerX, -centerY);

// æ‡‰ç”¨clip-pathæ•ˆæœï¼Œæ¨¡æ“¬CSSä¸­çš„polygon(25% 0, 75% 0, 100% 100%, 0 100%)
ctx.beginPath();
ctx.moveTo(canvas.width * 0.25, 0);
ctx.lineTo(canvas.width * 0.75, 0);
ctx.lineTo(canvas.width, canvas.height);
ctx.lineTo(0, canvas.height);
ctx.closePath();
ctx.clip();
```

#### 1.2 éŸ³ç¬¦ç¹ªè£½å‡½æ•¸ (drawNotes)
- **ä½ç½®**: `game.js` ç¬¬2216è¡Œé–‹å§‹
- **ä¿®æ”¹å…§å®¹**:
  - æ·»åŠ ç›¸åŒçš„3Dé€è¦–è®Šæ›
  - ç¢ºä¿éŸ³ç¬¦ä½ç½®è¨ˆç®—èˆ‡è»Œé“å°é½Š
  - æ‡‰ç”¨ç›¸åŒçš„è£å‰ªè·¯å¾‘

#### 1.3 éŠæˆ²å¾ªç’° (gameLoop)
- **ä½ç½®**: `game.js` ç¬¬1113è¡Œé–‹å§‹
- **ä¿®æ”¹å…§å®¹**:
  - æ·»åŠ è»Œé“ç¹ªè£½èª¿ç”¨ï¼š`laneManager.drawLanes(ctx, canvas)`
  - ç¢ºä¿ç¹ªè£½é †åºï¼šèƒŒæ™¯ â†’ è»Œé“ â†’ éŸ³ç¬¦ â†’ ç‰¹æ•ˆ

```javascript
drawBackground(ctx);

// ç¹ªè£½è³½é“ï¼ˆä¸­å¤®éœ“è™¹å¼•å°ç·šï¼‰
laneManager.drawLanes(ctx, canvas);

drawNotes(now);
```

### 2. CSS ä¿®æ”¹ (style.css)

#### 2.1 ç§»é™¤CSS 3Dè®Šæ›
- **ä½ç½®**: `style.css` ç¬¬1624è¡Œé–‹å§‹
- **ä¿®æ”¹å…§å®¹**:
  - è¨»é‡‹æ‰CSSä¸­çš„ `transform: perspective(800px) rotateX(8deg)`
  - é¿å…CSSå’ŒJavaScriptè®Šæ›è¡çª
  - çµ±ä¸€åœ¨JavaScriptä¸­è™•ç†æ‰€æœ‰3Dè®Šæ›

```css
#game-canvas {
    /* ç§»é™¤CSSçš„3Dè®Šæ›ï¼Œå› ç‚ºæˆ‘å€‘åœ¨JavaScriptä¸­è™•ç†ï¼Œç¢ºä¿ç¸®æ”¾ä¸€è‡´ */
    /* transform: perspective(800px) rotateX(8deg); */
    /* transform-origin: center bottom; */
}
```

## ğŸ¨ è¦–è¦ºæ•ˆæœèªªæ˜

### 3Dé€è¦–æ•ˆæœ
- **é€è¦–è·é›¢**: 800px
- **æ—‹è½‰è§’åº¦**: 8åº¦ (Xè»¸)
- **è®Šæ›åŸé»**: ä¸­å¿ƒåº•éƒ¨
- **è£å‰ªè·¯å¾‘**: æ¢¯å½¢æ•ˆæœï¼Œæ¨¡æ“¬è³½é“é€è¦–

### è»Œé“è¨­è¨ˆ
- **è»Œé“æ•¸é‡**: 5æ¢ (D, F, Space, J, K)
- **è»Œé“å¯¬åº¦**: `canvas.width / 5`
- **è»Œé“é¡è‰²**: 
  - D: é’è— (#00CFFF)
  - F: ç´«å…‰ (#A16EFF)
  - Space: é‡‘ç™½ (#FFD700)
  - J: ç²‰æ©˜ (#FF8888)
  - K: é›»å…‰è— (#66FFFF)

### éŸ³ç¬¦å°é½Š
- **ä½ç½®è¨ˆç®—**: `(lane + 0.5) * laneWidth`
- **è»Œè·¡æ•ˆæœ**: èˆ‡è»Œé“é¡è‰²ä¸€è‡´
- **ç™¼å…‰æ•ˆæœ**: èˆ‡è»Œé“ç™¼å…‰å¼·åº¦åŒ¹é…

## ğŸ§ª æ¸¬è©¦æ–‡ä»¶

å‰µå»ºäº† `test_scaling.html` æ¸¬è©¦æ–‡ä»¶ï¼Œç”¨æ–¼é©—è­‰ï¼š
- âœ… 3Dé€è¦–è®Šæ›ä¸€è‡´æ€§
- âœ… è£å‰ªè·¯å¾‘æ•ˆæœ
- âœ… è»Œé“å¯¬åº¦è¨ˆç®—
- âœ… éŸ³ç¬¦ä½ç½®å°é½Š
- âœ… è¦–è¦ºæ•ˆæœçµ±ä¸€æ€§

## ğŸ” æŠ€è¡“è¦é»

### è®Šæ›çŸ©é™£
```javascript
ctx.transform(
    1, 0,           // æ°´å¹³ç¸®æ”¾
    0, Math.cos(rotateX), // å‚ç›´ç¸®æ”¾ï¼ˆé€è¦–æ•ˆæœï¼‰
    0, 0            // ä½ç§»
);
```

### è£å‰ªè·¯å¾‘
```javascript
ctx.beginPath();
ctx.moveTo(canvas.width * 0.25, 0);    // å·¦ä¸Šè§’
ctx.lineTo(canvas.width * 0.75, 0);    // å³ä¸Šè§’
ctx.lineTo(canvas.width, canvas.height); // å³ä¸‹è§’
ctx.lineTo(0, canvas.height);          // å·¦ä¸‹è§’
ctx.closePath();
ctx.clip();
```

### ç‹€æ…‹ç®¡ç†
- ä½¿ç”¨ `ctx.save()` å’Œ `ctx.restore()` ç®¡ç†è®Šæ›ç‹€æ…‹
- ç¢ºä¿æ¯å€‹ç¹ªè£½å‡½æ•¸éƒ½èƒ½æ­£ç¢ºæ¢å¾©è®Šæ›

## ğŸ“‹ é©—è­‰æ¸…å–®

- [x] è»Œé“èˆ‡èƒŒæ™¯ç¸®æ”¾ä¸€è‡´
- [x] éŸ³ç¬¦èˆ‡è»Œé“å°é½Š
- [x] 3Dé€è¦–æ•ˆæœçµ±ä¸€
- [x] è£å‰ªè·¯å¾‘æ•ˆæœä¸€è‡´
- [x] ç™¼å…‰æ•ˆæœå”èª¿
- [x] å‹•ç•«æµæš¢æ€§ä¿æŒ
- [x] æ€§èƒ½å„ªåŒ–

## ğŸ® ä½¿ç”¨èªªæ˜

1. æ‰“é–‹ `Vibe_Codingçµ„_ç‹ç¥æ˜‡_TrioSync.html` ä¸»éŠæˆ²
2. é¸æ“‡æ­Œæ›²å’Œé›£åº¦
3. é–‹å§‹éŠæˆ²ï¼Œè§€å¯Ÿè»Œé“å’ŒéŸ³ç¬¦çš„ç¸®æ”¾ä¸€è‡´æ€§
4. å¯é¸ï¼šæ‰“é–‹ `test_scaling.html` é€²è¡Œç¨ç«‹æ¸¬è©¦

## ğŸ”§ æ•…éšœæ’é™¤

å¦‚æœç™¼ç¾ç¸®æ”¾ä¸ä¸€è‡´ï¼š
1. æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°æ˜¯å¦æœ‰éŒ¯èª¤
2. ç¢ºèªCanvaså°ºå¯¸è¨ˆç®—æ­£ç¢º
3. é©—è­‰è®Šæ›çŸ©é™£åƒæ•¸
4. æª¢æŸ¥ç¹ªè£½é †åº

## 2024/06/09 æ›´æ–°
- éŠæˆ²ç©æ³•å·²ç§»é™¤é•·éŸ³ç¬¦ï¼Œæ‰€æœ‰éŸ³ç¬¦çš†ç‚ºçŸ­éŸ³ç¬¦ã€‚
- ç›¸é—œç¹ªè£½ã€åˆ¤å®šã€è³‡æ–™çµæ§‹å·²åŒæ­¥ç§»é™¤ã€‚

---

**ä¿®æ”¹å®Œæˆæ™‚é–“**: 2024å¹´12æœˆ
**ä¿®æ”¹è€…**: AIåŠ©æ‰‹
**ç‰ˆæœ¬**: v1.0 